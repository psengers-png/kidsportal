<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Kleurplaat Generator</title>

    <style>
        body { font-family: Arial; background:#f9f9f9; margin:0; padding:0; }
        header { background:#4CAF50; color:white; padding:20px; text-align:center; }
        main { max-width:600px; margin:30px auto; padding:20px; background:white; border-radius:10px; }
        label { font-weight:bold; display:block; margin-bottom:5px; }
        input[type="text"], input[type="file"] { width:100%; padding:8px; margin-bottom:15px; }
        button { padding:10px 20px; background:#4CAF50; color:white; border:none; cursor:pointer; }
        button:hover { background:#45a049; }
        #backBtn { background:#555; margin-left:10px; }
    </style>
</head>

<body>

<header>
    <h1>Kleurplaat Generator</h1>
</header>

<main>

    <p id="statusText">Bezig met controleren...</p>

    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="backBtn" style="display:none;">Terug naar Home</button>

    <form id="kleurplaatForm" style="display:none;">
        <label>Wie?</label>
        <input id="wie" type="text">

        <label>Waar?</label>
        <input id="waar" type="text">

        <label>Welke activiteit?</label>
        <input id="activiteit" type="text">

        <label>Upload foto (optioneel)</label>
        <input id="foto" type="file">

        <button type="submit">Genereer kleurplaat</button>
    </form>

    <div id="resultaat"></div>

    <button id="downloadBtn" style="display:none;">Download</button>

    <button id="agentBtn" style="display:none; margin-top:20px;">
        ðŸ¤– Open Kleurplaat Agent
    </button>

</main>



<script>
document.addEventListener("DOMContentLoaded", () => {

    // 1. Check direct of MSAL een sessie ziet
    const accounts = msalInstance.getAllAccounts();

    if (!accounts || accounts.length === 0) {
        window.location.href = "/home.html";
        return;
    }

    // 2. Als we hier zijn â†’ gebruiker is ingelogd
    document.getElementById("kleurplaatForm").style.display = "block";
    document.getElementById("logoutBtn").style.display = "inline-block";
    document.getElementById("backBtn").style.display = "inline-block";

    // 3. Achtergrond logica
    initFormLogic();
});

// DE FORM LOGICA
function initFormLogic() {

    const fotoInput = document.getElementById("foto");
    const agentBtn = document.getElementById("agentBtn");

    // Terugknop
    document.getElementById("backBtn").onclick = () =>
        window.location.href = "/index.html";

    fotoInput.addEventListener("change", () => {
        const disabled = fotoInput.files.length > 0;
        document.getElementById("wie").disabled = disabled;
        document.getElementById("waar").disabled = disabled;
        document.getElementById("activiteit").disabled = disabled;
    });

    document.getElementById("kleurplaatForm").addEventListener("submit", (e) => {
        e.preventDefault();

        document.getElementById("resultaat").textContent =
            "Kleurplaat wordt aangemaakt...";

        agentBtn.style.display = "block";
        agentBtn.onclick = () => window.location.href = "/api/kleurplaat_agent";
    });
}
</script>
<!-- MSAL -->
<script src="JS/msal-browser.min.js"></script>
<script src="JS/auth.js"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Kleurplaat Generator</title>

    <style>
        body { font-family: Arial; background:#f9f9f9; margin:0; padding:0; }
        header { background:#4CAF50; color:white; padding:20px; text-align:center; }
        main { max-width:600px; margin:30px auto; padding:20px; background:white; border-radius:10px; }
        label { font-weight:bold; display:block; margin-bottom:5px; }
        input[type="text"], input[type="file"] { width:100%; padding:8px; margin-bottom:15px; }
        button { padding:10px 20px; background:#4CAF50; color:white; border:none; cursor:pointer; }
        button:hover { background:#45a049; }
        #resultaat { margin-top:20px; text-align:center; }
        img { max-width:100%; border:1px solid #000; border-radius:5px; }
    </style>
</head>
<body>

<header>
    <h1>Kleurplaat Generator</h1>
</header>

<main>
    <div class="auth-controls">
        <p id="statusText">Bezig met controleren...</p>
        <button id="logoutBtn" style="display:none;">Logout</button>
    </div>

    <form id="kleurplaatForm" style="display:none;">
        <label>Wie?</label>
        <input id="wie" type="text">

        <label>Waar?</label>
        <input id="waar" type="text">

        <label>Welke activiteit?</label>
        <input id="activiteit" type="text">

        <label>Upload foto (optioneel)</label>
        <input id="foto" type="file">

        <button type="submit">Genereer kleurplaat</button>
    </form>

    <div id="resultaat"></div>
    <button id="downloadBtn" style="display:none;">Download</button>
</main>

<!-- 1. Correcte MSAL -->
<script src="https://alcdn.msauth.net/browser/2.32.0/js/msal-browser.min.js"></script>

<!-- 2. Login / MSAL script -->
<script>
console.log("MSAL laadcontrole: ", typeof msal !== "undefined" ? "MSAL geladen" : "MSAL NIET geladen!");

const msalConfig = {
    auth: {
        clientId: "29dc0ff8-8b79-4291-b3bd-037f5f33c82f",
        authority: "https://kidsportal2.ciamlogin.com/4abbf94b-738e-4740-b4e7-e167dcc756ac",
        redirectUri: "https://black-mud-0da469403.6.azurestaticapps.net/kleurplaat.html",
        knownAuthorities: ["kidsportal2.ciamlogin.com"]
    },
    cache: { cacheLocation: "localStorage" }
};

const msalInstance = new msal.PublicClientApplication(msalConfig);

document.addEventListener("DOMContentLoaded", () => {
    console.log("DOMContentLoaded: script draait");

    msalInstance.initialize().then(() => {
        console.log("MSAL init klaar");

        msalInstance.handleRedirectPromise().then((resp) => {
            console.log("Redirect response:", resp);
        }).finally(() => {
            const acc = msalInstance.getAllAccounts();
            console.log("Accounts gevonden:", acc);

            if (acc.length === 0) {
                console.warn("Geen sessie â†’ terug naar home");
                window.location.href = "/home.html";
                return;
            }

            console.log("Ingelogd als:", acc[0].username);

            document.getElementById("statusText").textContent =
                `Welkom, ${acc[0].username}`;

            document.getElementById("kleurplaatForm").style.display = "block";
            document.getElementById("logoutBtn").style.display = "inline-block";

            initFormLogic();
        });
    });
});

// ---------------- FORM LOGIC ------------------

function initFormLogic() {
    console.log("Formulier activeert");

    const fotoInput = document.getElementById("foto");
    const wie = document.getElementById("wie");
    const waar = document.getElementById("waar");
    const activiteit = document.getElementById("activiteit");

    fotoInput.addEventListener("change", () => {
        const disabled = fotoInput.files.length > 0;
        wie.disabled = waar.disabled = activiteit.disabled = disabled;
    });
}
</script>

</body>
</html>
